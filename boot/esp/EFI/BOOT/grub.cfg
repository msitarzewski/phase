# Phase Boot - GRUB Fallback Configuration
# Used when systemd-boot is not available

set timeout=10
set default=0

# Search for the ESP partition containing our kernel
# Look for a file that uniquely identifies our ESP
search --no-floppy --set=root --file /vmlinuz-x86_64

# Fallback: search by filesystem label
if [ -z "$root" ]; then
    search --no-floppy --set=root --label PHASE_ESP
fi

# Fallback: search by partition type (EFI System Partition)
if [ -z "$root" ]; then
    search --no-floppy --set=root --fs-uuid --hint-bios=hd0,gpt1 --hint-efi=hd0,gpt1
fi

# Internet Mode - Full network connectivity
menuentry "Phase Boot — Internet Mode" {
    linux /vmlinuz-x86_64 phase.mode=internet phase.channel=stable console=tty0 console=ttyS0,115200 earlyprintk=efi,keep loglevel=8 ignore_loglevel fbcon=map:1 video=efifb:force
    initrd /initramfs-x86_64.img
}

# Local Mode - Cached operation
menuentry "Phase Boot — Local Mode" {
    linux /vmlinuz-x86_64 phase.mode=local phase.channel=stable phase.cache=enabled console=tty0 console=ttyS0,115200 earlyprintk=efi,keep loglevel=8 ignore_loglevel fbcon=map:1 video=efifb:force
    initrd /initramfs-x86_64.img
}

# Private Mode - Maximum privacy
menuentry "Phase Boot — Private Mode" {
    linux /vmlinuz-x86_64 phase.mode=private phase.cache=disabled phase.nowrite=true console=tty0 console=ttyS0,115200 earlyprintk=efi,keep loglevel=8 ignore_loglevel fbcon=map:1 video=efifb:force
    initrd /initramfs-x86_64.img
}
