# Phase Boot - GRUB Configuration for ARM64
# Used with Parallels on Apple Silicon

set timeout=5
set default=0

# Search for the partition containing the kernel
# This is needed because grub-mkstandalone uses memdisk as root
insmod part_gpt
insmod fat
insmod search
search --no-floppy --file /vmlinuz-arm64 --set=root

# Internet Mode - Full network connectivity
menuentry "Phase Boot — Internet Mode" {
    echo "Loading kernel from ${root}..."
    insmod gzio
    linux /vmlinuz-arm64 console=tty0 console=ttyAMA0,115200 earlyprintk phase.mode=internet phase.channel=stable
    initrd /initramfs-arm64.img
    echo "Booting..."
}

# Local Mode - Cached operation
menuentry "Phase Boot — Local Mode" {
    insmod gzio
    linux /vmlinuz-arm64 console=tty0 console=ttyAMA0,115200 earlyprintk phase.mode=local phase.channel=stable phase.cache=enabled
    initrd /initramfs-arm64.img
}

# Private Mode - Maximum privacy
menuentry "Phase Boot — Private Mode" {
    insmod gzio
    linux /vmlinuz-arm64 console=tty0 console=ttyAMA0,115200 earlyprintk phase.mode=private phase.cache=disabled phase.nowrite=true
    initrd /initramfs-arm64.img
}
